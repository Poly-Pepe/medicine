FROM golang:1.22.5-alpine3.18@sha256:1b531882ad8f3eae11ec2323803207acbde6408e030d91b8e159e2d72c1da1a1 AS builder

ENV CGO_ENABLED=0
ENV GOOS=linux

ARG APP_NAME
ENV APP_NAME="${APP_NAME}"

WORKDIR /build

COPY . .

RUN go build -o ${APP_NAME} ./app/main.go

FROM alpine:3.18.3@sha256:c5c5fda71656f28e49ac9c5416b3643eaa6a108a8093151d6d1afc9463be8e33

WORKDIR /root

COPY --from=builder /build/${APP_NAME} .

ARG APP_NAME
ENV APP_NAME="${APP_NAME}"

ENTRYPOINT ./${APP_NAME}