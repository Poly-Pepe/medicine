FROM golang:1.22.5-alpine3.20@sha256:0d3653dd6f35159ec6e3d10263a42372f6f194c3dea0b35235d72aabde86486e AS builder

ENV CGO_ENABLED=0
ENV GOOS=linux

ARG APP_NAME
ENV APP_NAME="${APP_NAME}"

WORKDIR /build

COPY . .

RUN go build -o ${APP_NAME} ./app/main.go

FROM alpine:3.20.3@sha256:beefdbd8a1da6d2915566fde36db9db0b524eb737fc57cd1367effd16dc0d06d

WORKDIR /root

COPY --from=builder /build/${APP_NAME} .

ARG APP_NAME
ENV APP_NAME="${APP_NAME}"

ENTRYPOINT ./${APP_NAME}